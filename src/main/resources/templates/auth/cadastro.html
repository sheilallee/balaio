<!DOCTYPE html>
<html lang="pt-BR"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Balaio - Cadastro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="min-h-screen bg-gradient-to-br from-amber-50 via-white to-orange-50">
<div class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md bg-white rounded-lg shadow-lg">
        <div class="text-center space-y-4 p-8 pb-4">
            <div class="flex justify-center">
                <div class="bg-amber-500 p-4 rounded-full">
                    <i class="fas fa-shopping-basket text-white text-5xl"></i>
                </div>
            </div>
            <h1 class="text-3xl font-bold">Criar Conta</h1>
            <p class="text-gray-600 mt-2">
                Junte-se ao Balaio e organize suas compras
            </p>
        </div>

        <!-- Mensagens de erro e sucesso -->
        <div th:if="${erro}" class="mx-8 mb-4 p-3 bg-red-50 border border-red-200 rounded-md">
            <p class="text-red-700 text-sm flex items-center">
                <i class="fas fa-exclamation-circle mr-2"></i>
                <span th:text="${erro}"></span>
            </p>
        </div>
        <div th:if="${sucesso}" class="mx-8 mb-4 p-3 bg-green-50 border border-green-200 rounded-md">
            <p class="text-green-700 text-sm flex items-center">
                <i class="fas fa-check-circle mr-2"></i>
                <span th:text="${sucesso}"></span>
            </p>
        </div>

        <!-- Formulário de Cadastro -->
        <div class="p-8 pt-4">
            <form th:action="@{/balaio/cadastro}"
                  th:object="${usuarioCadastroDTO}"
                  method="POST"
                  class="space-y-4"
                  id="cadastroForm">
                
                <!-- Campo Nome -->
                <div class="space-y-2">
                    <label for="nomeCompleto" class="block text-sm font-medium">
                        Nome <span class="text-red-500">*</span>
                    </label>
                    <input type="text"
                           id="nomeCompleto"
                           th:field="*{nomeCompleto}"
                           placeholder="Seu nome completo"
                           required
                           minlength="2"
                           maxlength="100"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md
                                  focus:outline-none focus:ring-2 focus:ring-amber-500
                                  transition-all">
                    <p class="text-xs text-gray-500">Entre 2 e 100 caracteres</p>
                </div>

                <!-- Campo E-mail -->
                <div class="space-y-2">
                    <label for="email" class="block text-sm font-medium">
                        E-mail <span class="text-red-500">*</span>
                    </label>
                    <input type="email"
                           id="email"
                           th:field="*{email}"
                           placeholder="seu@email.com"
                           required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md
                                  focus:outline-none focus:ring-2 focus:ring-amber-500
                                  transition-all">
                </div>

                <!-- Campo Senha -->
                <div class="space-y-2">
                    <label for="senha" class="block text-sm font-medium">
                        Senha <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <input type="password"
                               id="senha"
                               th:field="*{senha}"
                               placeholder="••••••••"
                               required
                               minlength="8"
                               class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-md
                                      focus:outline-none focus:ring-2 focus:ring-amber-500
                                      transition-all">
                        <button type="button"
                                onclick="togglePassword('senha')"
                                class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700">
                            <i class="fas fa-eye" id="senha-icon"></i>
                        </button>
                    </div>
                    <p class="text-xs text-gray-500">Mínimo 8 caracteres, pelo menos uma letra e um número</p>
                </div>

                <!-- Campo Confirmação de Senha -->
                <div class="space-y-2">
                    <label for="confirmarSenha" class="block text-sm font-medium">
                        Confirmação de Senha <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <input type="password"
                               id="confirmarSenha"
                               th:field="*{confirmarSenha}"
                               placeholder="••••••••"
                               required
                               minlength="8"
                               class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-md
                                      focus:outline-none focus:ring-2 focus:ring-amber-500
                                      transition-all">
                        <button type="button"
                                onclick="togglePassword('confirmarSenha')"
                                class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700">
                            <i class="fas fa-eye" id="confirmarSenha-icon"></i>
                        </button>
                    </div>
                    <p id="senhaMatch" class="text-xs hidden"></p>
                </div>

                <!-- Botão de Cadastro -->
                <button type="submit"
                        id="btnCadastro"
                        class="w-full bg-amber-500 hover:bg-amber-600 text-white font-medium
                               py-2 px-4 rounded-md transition-colors disabled:opacity-50 
                               disabled:cursor-not-allowed">
                    Cadastrar
                </button>

                <!-- Link para Login -->
                <div class="text-center text-sm">
                    <span class="text-gray-600">Já tem uma conta? </span>
                    <a th:href="@{/balaio/login}"
                       class="text-amber-600 hover:text-amber-700 hover:underline">
                        Fazer login
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Função para alternar visibilidade da senha
    function togglePassword(fieldId) {
        const field = document.getElementById(fieldId);
        const icon = document.getElementById(fieldId + '-icon');
        
        if (field.type === 'password') {
            field.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            field.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    }

    // Validação em tempo real
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('cadastroForm');
        const nomeInput = document.getElementById('nomeCompleto');
        const emailInput = document.getElementById('email');
        const senhaInput = document.getElementById('senha');
        const confirmarSenhaInput = document.getElementById('confirmarSenha');
        const senhaMatchMsg = document.getElementById('senhaMatch');
        const btnCadastro = document.getElementById('btnCadastro');

        // Validação do nome (CA3)
        nomeInput.addEventListener('input', function() {
            const valor = this.value.trim();
            if (valor.length > 0 && (valor.length < 2 || valor.length > 100)) {
                this.classList.add('border-red-500');
                this.classList.remove('border-gray-300');
            } else {
                this.classList.remove('border-red-500');
                this.classList.add('border-gray-300');
            }
        });

        // Validação do email (CA4)
        emailInput.addEventListener('blur', function() {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (this.value && !emailRegex.test(this.value)) {
                this.classList.add('border-red-500');
                this.classList.remove('border-gray-300');
            } else {
                this.classList.remove('border-red-500');
                this.classList.add('border-gray-300');
            }
        });

        // Validação da senha (CA6)
        function validarSenha(senha) {
            if (senha.length < 8) return false;
            const temLetra = /[A-Za-z]/.test(senha);
            const temNumero = /\d/.test(senha);
            return temLetra && temNumero;
        }

        senhaInput.addEventListener('input', function() {
            const senha = this.value;
            if (senha.length > 0 && !validarSenha(senha)) {
                this.classList.add('border-red-500');
                this.classList.remove('border-gray-300');
            } else {
                this.classList.remove('border-red-500');
                this.classList.add('border-gray-300');
            }
            verificarSenhasIguais();
        });

        // Validação de confirmação de senha (CA5)
        confirmarSenhaInput.addEventListener('input', verificarSenhasIguais);

        function verificarSenhasIguais() {
            const senha = senhaInput.value;
            const confirmarSenha = confirmarSenhaInput.value;
            
            if (confirmarSenha.length > 0) {
                if (senha !== confirmarSenha) {
                    senhaMatchMsg.textContent = 'As senhas não coincidem';
                    senhaMatchMsg.classList.remove('hidden', 'text-green-600');
                    senhaMatchMsg.classList.add('text-red-600');
                    confirmarSenhaInput.classList.add('border-red-500');
                    confirmarSenhaInput.classList.remove('border-gray-300');
                } else {
                    senhaMatchMsg.textContent = 'As senhas coincidem';
                    senhaMatchMsg.classList.remove('hidden', 'text-red-600');
                    senhaMatchMsg.classList.add('text-green-600');
                    confirmarSenhaInput.classList.remove('border-red-500');
                    confirmarSenhaInput.classList.add('border-gray-300');
                }
            } else {
                senhaMatchMsg.classList.add('hidden');
                confirmarSenhaInput.classList.remove('border-red-500');
                confirmarSenhaInput.classList.add('border-gray-300');
            }
        }

        // Validação antes do envio (CA1, CA2, CA5, CA6)
        form.addEventListener('submit', function(e) {
            const nome = nomeInput.value.trim();
            const email = emailInput.value.trim();
            const senha = senhaInput.value;
            const confirmarSenha = confirmarSenhaInput.value;

            // CA2 - Todos os campos obrigatórios
            if (!nome || !email || !senha || !confirmarSenha) {
                e.preventDefault();
                alert('Todos os campos são obrigatórios');
                return false;
            }

            // CA3 - Nome entre 2 e 100 caracteres
            if (nome.length < 2 || nome.length > 100) {
                e.preventDefault();
                alert('O nome deve ter entre 2 e 100 caracteres');
                nomeInput.focus();
                return false;
            }

            // CA4 - Email formato válido
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                e.preventDefault();
                alert('Por favor, insira um e-mail válido');
                emailInput.focus();
                return false;
            }

            // CA5 - Senhas devem ser idênticas
            if (senha !== confirmarSenha) {
                e.preventDefault();
                alert('As senhas não coincidem');
                confirmarSenhaInput.focus();
                return false;
            }

            // CA6 - Senha mínimo 8 caracteres, letra e número
            if (!validarSenha(senha)) {
                e.preventDefault();
                alert('A senha deve ter no mínimo 8 caracteres, pelo menos uma letra e um número');
                senhaInput.focus();
                return false;
            }

            // Desabilita o botão para evitar duplo envio
            btnCadastro.disabled = true;
            btnCadastro.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Cadastrando...';
        });
    });
</script>
</body>
</html>
